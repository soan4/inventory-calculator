<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó„Ç¢„Éó„É™</title>
    
    <!-- PWAË®≠ÂÆö -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó">
    <link rel="apple-touch-icon" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcikiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyek05IDE3bC01LTVoM1Y5aDRsMi0yaDR2Mmg0bC01IDV6Ii8+Cjwvc3ZnPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudDBfbGluZWFyIiB4MT0iMCIgeTE9IjAiIHgyPSIxOTIiIHkyPSIxOTIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            border-color: #e9ecef;
        }

        .data-mode-toggle {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .data-mode-toggle h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .toggle-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .toggle-btn.active {
            background: #667eea;
            color: white;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            min-width: 200px;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .results {
            display: none;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            border-left: 4px solid #27ae60;
        }

        .results h3 {
            color: #27ae60;
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
        }

        .result-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .result-value {
            font-size: 2em;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 5px;
        }

        .result-unit {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .calculation-details {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e6ed;
        }

        .calculation-details h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .calculation-step {
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .calculation-mode {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .calculation-mode h5 {
            color: #1976d2;
            margin-bottom: 5px;
        }

        .calculation-mode p {
            color: #424242;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-section {
                padding: 20px;
            }

            .toggle-buttons {
                flex-direction: column;
                align-items: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }

        /* PWAÂ∞ÇÁî®„Çπ„Çø„Ç§„É´ */
        @media (display-mode: standalone) {
            .header {
                padding-top: 50px; /* „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉºÂØæÂøú */
            }
            
            body {
                padding-top: 0;
            }
        }

        /* „Ç§„É≥„Çπ„Éà„Éº„É´„Éê„Éä„Éº„Çπ„Çø„Ç§„É´ */
        .install-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .install-banner.show {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó„Ç¢„Éó„É™</h1>
            <p>Â∞èÂ£≤Ê•≠Âêë„ÅëÂú®Â∫´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†ÔºàÊò®Âπ¥„Éá„Éº„ÇøÂØæÂøúÁâàÔºâ</p>
        </div>

        <div class="content">
            <div class="data-mode-toggle">
                <h3>üìä „Éá„Éº„ÇøÂÖ•Âäõ„É¢„Éº„ÉâÈÅ∏Êäû</h3>
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="toggleDataMode('current')">‰ªäÂπ¥„Éá„Éº„Çø„ÅÆ„Åø</button>
                    <button class="toggle-btn" onclick="toggleDataMode('comparison')">Êò®Âπ¥„Éá„Éº„Çø„Å®ÊØîËºÉ</button>
                </div>
            </div>

            <div class="form-section">
                <h3>üìà ÈÅéÂéª4ÈÄ±Èñì„ÅÆË≤©Â£≤ÂÆüÁ∏æ</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="week1">Á¨¨1ÈÄ± Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="week1" min="0" placeholder="‰æã: 100">
                    </div>
                    <div class="form-group">
                        <label for="week2">Á¨¨2ÈÄ± Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="week2" min="0" placeholder="‰æã: 120">
                    </div>
                    <div class="form-group">
                        <label for="week3">Á¨¨3ÈÄ± Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="week3" min="0" placeholder="‰æã: 110">
                    </div>
                    <div class="form-group">
                        <label for="week4">Á¨¨4ÈÄ± Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="week4" min="0" placeholder="‰æã: 130">
                    </div>
                </div>
            </div>

            <div class="form-section" id="last-year-section" style="display: none;">
                <h3>üìÖ Êò®Âπ¥ÂêåÊúü4ÈÄ±Èñì„ÅÆË≤©Â£≤ÂÆüÁ∏æ</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="last-week1">Êò®Âπ¥ÂêåÈÄ± Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="last-week1" min="0" placeholder="‰æã: 90">
                    </div>
                    <div class="form-group">
                        <label for="last-week2">Êò®Âπ¥1ÈÄ±ÂÖà Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="last-week2" min="0" placeholder="‰æã: 95">
                    </div>
                    <div class="form-group">
                        <label for="last-week3">Êò®Âπ¥2ÈÄ±ÂÖà Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="last-week3" min="0" placeholder="‰æã: 100">
                    </div>
                    <div class="form-group">
                        <label for="last-week4">Êò®Âπ¥3ÈÄ±ÂÖà Ë≤©Â£≤Êï∞</label>
                        <input type="number" id="last-week4" min="0" placeholder="‰æã: 105">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>‚öôÔ∏è Ë®≠ÂÆö„Éë„É©„É°„Éº„Çø</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="abc-rank">ABC„É©„É≥„ÇØ</label>
                        <select id="abc-rank">
                            <option value="A">A„É©„É≥„ÇØ (È´òÈáçË¶ÅÂ∫¶„ÉªÊ¨†ÂìÅÂõûÈÅø)</option>
                            <option value="B">B„É©„É≥„ÇØ (‰∏≠ÈáçË¶ÅÂ∫¶„ÉªÊ®ôÊ∫ñÁÆ°ÁêÜ)</option>
                            <option value="C">C„É©„É≥„ÇØ (‰ΩéÈáçË¶ÅÂ∫¶„ÉªÂú®Â∫´ÂâäÊ∏õ)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lead-time">„É™„Éº„Éâ„Çø„Ç§„É†</label>
                        <input type="number" id="lead-time" value="4" min="1" max="30">
                        <small style="color: #7f8c8d; margin-top: 5px;">Êó•Êï∞</small>
                    </div>
                    <div class="form-group">
                        <label for="order-cycle">Áô∫Ê≥®„Çµ„Ç§„ÇØ„É´</label>
                        <input type="number" id="order-cycle" value="7" min="1" max="90">
                        <small style="color: #7f8c8d; margin-top: 5px;">Êó•Êï∞</small>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateInventory()">üìà ÈÅ©Ê≠£Âú®Â∫´„ÇíË®àÁÆó</button>

            <div class="results" id="results">
                <div class="calculation-mode" id="calculation-mode-display"></div>
                
                <h3>Ë®àÁÆóÁµêÊûú</h3>
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Áô∫Ê≥®ÁÇπ</h4>
                        <div class="result-value" id="reorder-point">--</div>
                        <div class="result-unit">ÂÄã</div>
                    </div>
                    <div class="result-item">
                        <h4>ÈÅ©Ê≠£Âú®Â∫´ÔºàÊúÄÂ§ßÂú®Â∫´Ôºâ</h4>
                        <div class="result-value" id="max-inventory">--</div>
                        <div class="result-unit">ÂÄã</div>
                    </div>
                    <div class="result-item">
                        <h4>Âπ≥ÂùáÊó•Ê¨°ÈúÄË¶Å</h4>
                        <div class="result-value" id="daily-demand">--</div>
                        <div class="result-unit">ÂÄã/Êó•</div>
                    </div>
                    <div class="result-item">
                        <h4>ÂÆâÂÖ®Âú®Â∫´</h4>
                        <div class="result-value" id="safety-stock">--</div>
                        <div class="result-unit">ÂÄã</div>
                    </div>
                </div>

                <div class="calculation-details">
                    <h4>Ë®àÁÆóË©≥Á¥∞</h4>
                    <div id="calculation-steps"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDataMode = 'current';

        // PWAË®≠ÂÆö
        window.addEventListener('load', () => {
            setupPWA();
        });

        function setupPWA() {
            // „Éû„Éã„Éï„Çß„Çπ„Éà„ÇíÂãïÁöÑ„Å´ÁîüÊàê
            const manifestData = {
                "name": "ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó„Ç¢„Éó„É™",
                "short_name": "Âú®Â∫´Ë®àÁÆó",
                "description": "Â∞èÂ£≤Ê•≠Âêë„ÅëÈÅ©Ê≠£Âú®Â∫´„ÉªÁô∫Ê≥®ÁÇπË®àÁÆó„Ç¢„Éó„É™",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#ffffff",
                "theme_color": "#667eea",
                "orientation": "portrait",
                "icons": [
                    {
                        "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcikiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0yMCAzSDE0TDEwLjUgNi41TDEwIDdINFYxOEgxOFY3SDE2TDIwIDNaTTcgMTBIMTNWMTJIN1YxMFpNNyAxM0gxM1YxNUg3VjEzWk03IDE2SDEzVjE4SDdWMTZaIi8+Cjwvc3ZnPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudDBfbGluZWFyIiB4MT0iMCIgeTE9IjAiIHgyPSIxOTIiIHkyPSIxOTIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K",
                        "sizes": "192x192",
                        "type": "image/svg+xml",
                        "purpose": "any maskable"
                    },
                    {
                        "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iNjQiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcikiLz4KPHN2ZyB4PSIxMjgiIHk9IjEyOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMjAgM0gxNEwxMC41IDYuNUwxMCA3SDRWMThIMThWN0gxNkwyMCAzWk03IDEwSDEzVjEySDdWMTBaTTcgMTNIMTNWMTVIN1YxM1pNNyAxNkgxM1YxOEg3VjE2WiIvPgo8L3N2Zz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQwX2xpbmVhciIgeDE9IjAiIHkxPSIwIiB4Mj0iNTEyIiB5Mj0iNTEyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiM2NjdlZWEiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNzY0YmEyIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg==",
                        "sizes": "512x512",
                        "type": "image/svg+xml"
                    }
                ]
            };

            // „Éû„Éã„Éï„Çß„Çπ„Éà„ÇíBlob URL„Å®„Åó„Å¶‰ΩúÊàê
            const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            document.getElementById('manifest-placeholder').href = manifestURL;

            // Service WorkerÁôªÈå≤
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'inventory-calculator-v1';
                    const urlsToCache = [
                        './',
                        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcikiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0yMCAzSDE0TDEwLjUgNi5MMTAgN0g0VjE4SDE4VjdIMTZMMjAgM1pNNyAxMEgxM1YxMkg3VjEwWk03IDEzSDEzVjE1SDdWMTNaTTcgMTZIMTNWMThIN1YxNloiLz4KPC9zdmc+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXIiIHgxPSIwIiB5MT0iMCIgeDI9IjE5MiIgeTI9IjE5MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNjY3ZWVhIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzc2NGJhMiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo='
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;

                const swBlob = new Blob([swCode], {type: 'application/javascript'});
                const swURL = URL.createObjectURL(swBlob);

                navigator.serviceWorker.register(swURL)
                    .then(function(registration) {
                        console.log('Service Worker registered successfully');
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed');
                    });
            }

            // „Ç§„É≥„Çπ„Éà„Éº„É´„Éó„É≠„É≥„Éó„Éà
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallBanner();
            });

            function showInstallBanner() {
                const banner = document.createElement('div');
                banner.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 15px;
                        text-align: center;
                        z-index: 1000;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    ">
                        <div style="margin-bottom: 10px;">üì± „Åì„ÅÆ„Ç¢„Éó„É™„Çí„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Åß„Åç„Åæ„Åô</div>
                        <button onclick="installApp()" style="
                            background: white;
                            color: #667eea;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-weight: 600;
                            cursor: pointer;
                            margin-right: 10px;
                        ">„Ç§„É≥„Çπ„Éà„Éº„É´</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: transparent;
                            color: white;
                            border: 1px solid white;
                            padding: 8px 16px;
                            border-radius: 20px;
                            cursor: pointer;
                        ">Âæå„Åß</button>
                    </div>
                `;
                document.body.appendChild(banner);
                
                // Ëá™ÂãïÁöÑ„Å´„Éê„Éä„Éº„Çí5ÁßíÂæå„Å´Ê∂à„Åô
                setTimeout(() => {
                    if (banner.parentElement) {
                        banner.remove();
                    }
                }, 5000);
            }

            window.installApp = function() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                    });
                }
                // „Éê„Éä„Éº„ÇíÂâäÈô§
                const banner = document.querySelector('[style*="position: fixed"]');
                if (banner) banner.remove();
            };
        }

        // ABCÂàÜÊûê„Å´„Çà„ÇãÂÆâÂÖ®Âú®Â∫´‰øÇÊï∞Ë®≠ÂÆö
        const ABC_SAFETY_COEFFICIENTS = {
            A: 1.65,  // 95%„Çµ„Éº„Éì„Çπ„É¨„Éô„É´ - Ê¨†ÂìÅÂõûÈÅøÊúÄÂÑ™ÂÖà
            B: 1.28,  // 90%„Çµ„Éº„Éì„Çπ„É¨„Éô„É´ - Ê®ôÊ∫ñÁÆ°ÁêÜ
            C: 0.84   // 80%„Çµ„Éº„Éì„Çπ„É¨„Éô„É´ - Âú®Â∫´ÂâäÊ∏õÈáçË¶ñ
        };

        function toggleDataMode(mode) {
            currentDataMode = mode;
            
            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖãÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Êò®Âπ¥„Éá„Éº„ÇøÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const lastYearSection = document.getElementById('last-year-section');
            if (mode === 'comparison') {
                lastYearSection.style.display = 'block';
            } else {
                lastYearSection.style.display = 'none';
                // Êò®Âπ¥„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
                ['last-week1', 'last-week2', 'last-week3', 'last-week4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
            }
        }

        function calculateInventory() {
            // ÂÖ•ÂäõÂÄ§ÂèñÂæó
            const week1 = parseFloat(document.getElementById('week1').value) || 0;
            const week2 = parseFloat(document.getElementById('week2').value) || 0;
            const week3 = parseFloat(document.getElementById('week3').value) || 0;
            const week4 = parseFloat(document.getElementById('week4').value) || 0;
            const abcRank = document.getElementById('abc-rank').value;
            const leadTime = parseFloat(document.getElementById('lead-time').value) || 4;
            const orderCycle = parseFloat(document.getElementById('order-cycle').value) || 7;

            // ÂÖ•Âäõ„ÉÅ„Çß„ÉÉ„ÇØ
            if (week1 + week2 + week3 + week4 === 0) {
                alert('Ë≤©Â£≤ÂÆüÁ∏æ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            let calculationSteps = [];
            let modeInfo = {};

            if (currentDataMode === 'current') {
                // ‰ªäÂπ¥„Éá„Éº„Çø„ÅÆ„Åø„É¢„Éº„Éâ
                const result = calculateCurrentOnly(week1, week2, week3, week4, abcRank, leadTime, orderCycle);
                displayResults(result.values, result.steps);
                modeInfo = {
                    title: '‰ªäÂπ¥„Éá„Éº„Çø„ÅÆ„Åø„É¢„Éº„Éâ',
                    description: 'ÈÅéÂéª4ÈÄ±Èñì„ÅÆË≤©Â£≤ÂÆüÁ∏æ„ÅÆ„Åø„Çí‰ΩøÁî®„Åó„ÅüË®àÁÆó„Åß„Åô„ÄÇ'
                };
            } else {
                // Êò®Âπ¥ÊØîËºÉ„É¢„Éº„Éâ
                const lastWeek1 = parseFloat(document.getElementById('last-week1').value) || 0;
                const lastWeek2 = parseFloat(document.getElementById('last-week2').value) || 0;
                const lastWeek3 = parseFloat(document.getElementById('last-week3').value) || 0;
                const lastWeek4 = parseFloat(document.getElementById('last-week4').value) || 0;

                if (lastWeek1 + lastWeek2 + lastWeek3 + lastWeek4 === 0) {
                    alert('Êò®Âπ¥„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åô„Çã„Åã„ÄÅ„Äå‰ªäÂπ¥„Éá„Éº„Çø„ÅÆ„Åø„Äç„É¢„Éº„Éâ„Å´Â§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                const result = calculateWithComparison(
                    week1, week2, week3, week4,
                    lastWeek1, lastWeek2, lastWeek3, lastWeek4,
                    abcRank, leadTime, orderCycle
                );
                displayResults(result.values, result.steps);
                modeInfo = {
                    title: 'Êò®Âπ¥„Éá„Éº„ÇøÊØîËºÉ„É¢„Éº„Éâ',
                    description: 'Êò®Âπ¥ÂêåÊúü„Éá„Éº„Çø„Å®ÊØîËºÉ„Åó„ÄÅÂ≠£ÁØÄÊÄß„Å®„Éà„É¨„É≥„Éâ„ÇíËÄÉÊÖÆ„Åó„ÅüÈ´òÁ≤æÂ∫¶Ë®àÁÆó„Åß„Åô„ÄÇ'
                };
            }

            // Ë®àÁÆó„É¢„Éº„ÉâË°®Á§∫
            document.getElementById('calculation-mode-display').innerHTML = `
                <h5>${modeInfo.title}</h5>
                <p>${modeInfo.description}</p>
            `;
        }

        function calculateCurrentOnly(week1, week2, week3, week4, abcRank, leadTime, orderCycle) {
            const totalSales = week1 + week2 + week3 + week4;
            const averageDailyDemand = totalSales / 28;
            
            // ÈÄ±Âπ≥Âùá„Å®Ê®ôÊ∫ñÂÅèÂ∑Æ
            const weeklyAverage = totalSales / 4;
            const weeklyVariance = ((week1 - weeklyAverage) ** 2 + 
                                  (week2 - weeklyAverage) ** 2 + 
                                  (week3 - weeklyAverage) ** 2 + 
                                  (week4 - weeklyAverage) ** 2) / 4;
            const weeklyStdDev = Math.sqrt(weeklyVariance);
            const dailyStdDev = weeklyStdDev / Math.sqrt(7);

            // ABCÂÆâÂÖ®Âú®Â∫´‰øÇÊï∞ÂèñÂæó
            const safetyCoeff = ABC_SAFETY_COEFFICIENTS[abcRank];

            // ÂÆâÂÖ®Âú®Â∫´Ë®àÁÆó
            const safetyStock = safetyCoeff * Math.sqrt(leadTime) * dailyStdDev;

            // Áô∫Ê≥®ÁÇπË®àÁÆó
            const reorderPoint = (averageDailyDemand * leadTime) + safetyStock;

            // Áô∫Ê≥®ÈáèË®àÁÆóÔºàABC„É©„É≥„ÇØ„Å´Èñ¢‰øÇ„Å™„Åè‰∏ÄÂæãÔºâ
            const orderQuantity = averageDailyDemand * orderCycle;

            // ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó
            const maxInventory = reorderPoint + orderQuantity;

            const steps = [
                `„ÄêÂü∫Êú¨Ë®àÁÆó„Äë`,
                `ÂêàË®àË≤©Â£≤Êï∞: ${totalSales}ÂÄã`,
                `Âπ≥ÂùáÊó•Ê¨°ÈúÄË¶Å: ${totalSales} √∑ 28 = ${averageDailyDemand.toFixed(2)}ÂÄã/Êó•`,
                `ÈÄ±Ë≤©Â£≤Ê®ôÊ∫ñÂÅèÂ∑Æ: ${weeklyStdDev.toFixed(2)}ÂÄã`,
                `Êó•Ê¨°ÈúÄË¶ÅÊ®ôÊ∫ñÂÅèÂ∑Æ: ${dailyStdDev.toFixed(2)}ÂÄã/Êó•`,
                `„ÄêÂú®Â∫´Ë®àÁÆó„Äë`,
                `ÂÆâÂÖ®Âú®Â∫´‰øÇÊï∞(${abcRank}„É©„É≥„ÇØ): ${safetyCoeff}`,
                `ÂÆâÂÖ®Âú®Â∫´: ${safetyCoeff} √ó ‚àö${leadTime} √ó ${dailyStdDev.toFixed(2)} = ${safetyStock.toFixed(1)}ÂÄã`,
                `Áô∫Ê≥®ÁÇπ: (${averageDailyDemand.toFixed(2)} √ó ${leadTime}) + ${safetyStock.toFixed(1)} = ${reorderPoint.toFixed(1)}ÂÄã`,
                `Áô∫Ê≥®Èáè: ${averageDailyDemand.toFixed(2)} √ó ${orderCycle} = ${orderQuantity.toFixed(1)}ÂÄã`,
                `ÈÅ©Ê≠£Âú®Â∫´: ${reorderPoint.toFixed(1)} + ${orderQuantity.toFixed(1)} = ${maxInventory.toFixed(1)}ÂÄã`
            ];

            return {
                values: {
                    dailyDemand: averageDailyDemand,
                    safetyStock: safetyStock,
                    reorderPoint: reorderPoint,
                    maxInventory: maxInventory
                },
                steps: steps
            };
        }

        function calculateWithComparison(week1, week2, week3, week4, lastWeek1, lastWeek2, lastWeek3, lastWeek4, abcRank, leadTime, orderCycle) {
            const currentTotal = week1 + week2 + week3 + week4;
            const lastYearTotal = lastWeek1 + lastWeek2 + lastWeek3 + lastWeek4;
            
            // Â≠£ÁØÄË™øÊï¥‰øÇÊï∞
            const seasonalFactor = currentTotal / lastYearTotal;
            
            // Âü∫Êú¨Êó•Ê¨°ÈúÄË¶Å
            const baseDailyDemand = currentTotal / 28;
            
            // ‰∫àÊ∏¨Êó•Ê¨°ÈúÄË¶ÅÔºàÂ≠£ÁØÄË™øÊï¥ÈÅ©Áî®Ôºâ
            const adjustedDailyDemand = baseDailyDemand * Math.min(seasonalFactor, 2.0); // ‰∏äÈôê2ÂÄç„ÅßÂÆâÂÖ®ÊÄßÁ¢∫‰øù
            
            // ‰ªäÂπ¥„ÅÆÈÄ±Â§âÂãï
            const currentWeeklyAvg = currentTotal / 4;
            const currentWeeklyVar = ((week1 - currentWeeklyAvg) ** 2 + 
                                   (week2 - currentWeeklyAvg) ** 2 + 
                                   (week3 - currentWeeklyAvg) ** 2 + 
                                   (week4 - currentWeeklyAvg) ** 2) / 4;
            
            // Êò®Âπ¥„ÅÆÈÄ±Â§âÂãï
            const lastYearWeeklyAvg = lastYearTotal / 4;
            const lastYearWeeklyVar = ((lastWeek1 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek2 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek3 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek4 - lastYearWeeklyAvg) ** 2) / 4;
            
            // Âπ¥ÈñìÂ§âÂãï„ÇíËÄÉÊÖÆ„Åó„ÅüÊ®ôÊ∫ñÂÅèÂ∑Æ
            const combinedWeeklyVar = (currentWeeklyVar + lastYearWeeklyVar) / 2;
            const weeklyStdDev = Math.sqrt(combinedWeeklyVar);
            const dailyStdDev = weeklyStdDev / Math.sqrt(7);

            // ABCÂÆâÂÖ®Âú®Â∫´‰øÇÊï∞ÂèñÂæó
            const safetyCoeff = ABC_SAFETY_COEFFICIENTS[abcRank];

            // ÂÆâÂÖ®Âú®Â∫´Ë®àÁÆóÔºàË™øÊï¥„Åï„Çå„ÅüÈúÄË¶Å„Å®„Çà„ÇäÁ≤æÂØÜ„Å™Ê®ôÊ∫ñÂÅèÂ∑Æ„Çí‰ΩøÁî®Ôºâ
            const safetyStock = safetyCoeff * Math.sqrt(leadTime) * dailyStdDev;

            // Áô∫Ê≥®ÁÇπË®àÁÆó
            const reorderPoint = (adjustedDailyDemand * leadTime) + safetyStock;

            // Áô∫Ê≥®ÈáèË®àÁÆóÔºàABC„É©„É≥„ÇØ„Å´Èñ¢‰øÇ„Å™„Åè‰∏ÄÂæãÔºâ
            const orderQuantity = adjustedDailyDemand * orderCycle;

            // ÈÅ©Ê≠£Âú®Â∫´Ë®àÁÆó
            const maxInventory = reorderPoint + orderQuantity;

            const steps = [
                `„ÄêÂ≠£ÁØÄÊÄßÂàÜÊûê„Äë`,
                `‰ªäÂπ¥4ÈÄ±ÂêàË®à: ${currentTotal}ÂÄã`,
                `Êò®Âπ¥ÂêåÊúü4ÈÄ±ÂêàË®à: ${lastYearTotal}ÂÄã`,
                `Â≠£ÁØÄË™øÊï¥‰øÇÊï∞: ${currentTotal} √∑ ${lastYearTotal} = ${seasonalFactor.toFixed(3)}`,
                `„ÄêÈúÄË¶Å‰∫àÊ∏¨„Äë`,
                `Âü∫Êú¨Êó•Ê¨°ÈúÄË¶Å: ${currentTotal} √∑ 28 = ${baseDailyDemand.toFixed(2)}ÂÄã/Êó•`,
                `Ë™øÊï¥ÂæåÊó•Ê¨°ÈúÄË¶Å: ${baseDailyDemand.toFixed(2)} √ó ${Math.min(seasonalFactor, 2.0).toFixed(3)} = ${adjustedDailyDemand.toFixed(2)}ÂÄã/Êó•`,
                `„ÄêÂ§âÂãïÂàÜÊûê„Äë`,
                `‰ªäÂπ¥ÈÄ±Ê®ôÊ∫ñÂÅèÂ∑Æ: ${Math.sqrt(currentWeeklyVar).toFixed(2)}ÂÄã`,
                `Êò®Âπ¥ÈÄ±Ê®ôÊ∫ñÂÅèÂ∑Æ: ${Math.sqrt(lastYearWeeklyVar).toFixed(2)}ÂÄã`,
                `Áµ±ÂêàÊó•Ê¨°Ê®ôÊ∫ñÂÅèÂ∑Æ: ${dailyStdDev.toFixed(2)}ÂÄã/Êó•`,
                `„ÄêÂú®Â∫´Ë®àÁÆó„Äë`,
                `ÂÆâÂÖ®Âú®Â∫´‰øÇÊï∞(${abcRank}„É©„É≥„ÇØ): ${safetyCoeff}`,
                `ÂÆâÂÖ®Âú®Â∫´: ${safetyCoeff} √ó ‚àö${leadTime} √ó ${dailyStdDev.toFixed(2)} = ${safetyStock.toFixed(1)}ÂÄã`,
                `Áô∫Ê≥®ÁÇπ: (${adjustedDailyDemand.toFixed(2)} √ó ${leadTime}) + ${safetyStock.toFixed(1)} = ${reorderPoint.toFixed(1)}ÂÄã`,
                `Áô∫Ê≥®Èáè: ${adjustedDailyDemand.toFixed(2)} √ó ${orderCycle} = ${orderQuantity.toFixed(1)}ÂÄã`,
                `ÈÅ©Ê≠£Âú®Â∫´: ${reorderPoint.toFixed(1)} + ${orderQuantity.toFixed(1)} = ${maxInventory.toFixed(1)}ÂÄã`
            ];

            return {
                values: {
                    dailyDemand: adjustedDailyDemand,
                    safetyStock: safetyStock,
                    reorderPoint: reorderPoint,
                    maxInventory: maxInventory
                },
                steps: steps
            };
        }

        function displayResults(values, steps) {
            document.getElementById('daily-demand').textContent = values.dailyDemand.toFixed(1);
            document.getElementById('safety-stock').textContent = Math.ceil(values.safetyStock);
            document.getElementById('reorder-point').textContent = Math.ceil(values.reorderPoint);
            document.getElementById('max-inventory').textContent = Math.ceil(values.maxInventory);

            document.getElementById('calculation-steps').innerHTML = 
                steps.map(step => `<div class="calculation-step">${step}</div>`).join('');

            // ÁµêÊûú„Ç®„É™„Ç¢Ë°®Á§∫
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Enter„Ç≠„Éº„ÅßË®àÁÆóÂÆüË°å
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateInventory();
            }
        });
    </script>
</body>
</html>
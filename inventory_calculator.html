<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©æ­£åœ¨åº«è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #CCDAE5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #437397;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 40px;
            padding: 25px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #437397;
            box-shadow: 0 4px 15px rgba(67, 115, 151, 0.1);
        }

        .form-section h3 {
            color: #437397;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #437397;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input, select {
            padding: 12px;
            border: 2px solid #C6B89B;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #437397;
            box-shadow: 0 0 0 3px rgba(67, 115, 151, 0.1);
        }

        .data-mode-toggle {
            background: white;
            border: 2px solid #C6B89B;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(198, 184, 155, 0.1);
        }

        .data-mode-toggle h3 {
            color: #437397;
            margin-bottom: 15px;
            text-align: center;
        }

        .toggle-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid #C6B89B;
            background: white;
            color: #437397;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .toggle-btn.active {
            background: #437397;
            color: white;
            border-color: #437397;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 115, 151, 0.2);
        }

        .calculate-btn {
            background: #DA9180;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(218, 145, 128, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(218, 145, 128, 0.4);
            background: #d67a67;
        }

        .results {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            border-left: 4px solid #DA9180;
            box-shadow: 0 4px 15px rgba(218, 145, 128, 0.1);
        }

        .results h3 {
            color: #DA9180;
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .result-item {
            background: #CCDAE5;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(67, 115, 151, 0.1);
            text-align: center;
            border: 1px solid #C6B89B;
        }

        .result-item h4 {
            color: #437397;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .result-value {
            font-size: 2em;
            font-weight: 700;
            color: #DA9180;
            margin-bottom: 5px;
        }

        .result-unit {
            color: #437397;
            font-size: 0.9em;
            font-weight: 500;
        }

        .calculation-details {
            margin-top: 30px;
            padding: 20px;
            background: #CCDAE5;
            border-radius: 8px;
            border: 1px solid #C6B89B;
        }

        .calculation-details h4 {
            color: #437397;
            margin-bottom: 15px;
        }

        .calculation-step {
            margin-bottom: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            border-left: 3px solid #C6B89B;
        }

        .calculation-mode {
            background: #CCDAE5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #437397;
        }

        .calculation-mode h5 {
            color: #437397;
            margin-bottom: 5px;
        }

        .calculation-mode p {
            color: #437397;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-section {
                padding: 20px;
            }

            .toggle-buttons {
                flex-direction: column;
                align-items: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é©æ­£åœ¨åº«è¨ˆç®—ã‚¢ãƒ—ãƒª</h1>
            <p>å°å£²æ¥­å‘ã‘åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="content">
            <div class="data-mode-toggle">
                <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h3>
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="toggleDataMode('current')">ä»Šå¹´ãƒ‡ãƒ¼ã‚¿ã®ã¿</button>
                    <button class="toggle-btn" onclick="toggleDataMode('comparison')">æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒ</button>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“ˆ éå»4é€±é–“ã®è²©å£²å®Ÿç¸¾</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="week1">ç¬¬1é€± è²©å£²æ•°</label>
                        <input type="number" id="week1" min="0" placeholder="ä¾‹: 100">
                    </div>
                    <div class="form-group">
                        <label for="week2">ç¬¬2é€± è²©å£²æ•°</label>
                        <input type="number" id="week2" min="0" placeholder="ä¾‹: 120">
                    </div>
                    <div class="form-group">
                        <label for="week3">ç¬¬3é€± è²©å£²æ•°</label>
                        <input type="number" id="week3" min="0" placeholder="ä¾‹: 110">
                    </div>
                    <div class="form-group">
                        <label for="week4">ç¬¬4é€± è²©å£²æ•°</label>
                        <input type="number" id="week4" min="0" placeholder="ä¾‹: 130">
                    </div>
                </div>
            </div>

            <div class="form-section" id="last-year-section" style="display: none;">
                <h3>ğŸ“… æ˜¨å¹´åŒæœŸ4é€±é–“ã®è²©å£²å®Ÿç¸¾</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="last-week1">æ˜¨å¹´åŒé€± è²©å£²æ•°</label>
                        <input type="number" id="last-week1" min="0" placeholder="ä¾‹: 90">
                    </div>
                    <div class="form-group">
                        <label for="last-week2">æ˜¨å¹´1é€±å…ˆ è²©å£²æ•°</label>
                        <input type="number" id="last-week2" min="0" placeholder="ä¾‹: 95">
                    </div>
                    <div class="form-group">
                        <label for="last-week3">æ˜¨å¹´2é€±å…ˆ è²©å£²æ•°</label>
                        <input type="number" id="last-week3" min="0" placeholder="ä¾‹: 100">
                    </div>
                    <div class="form-group">
                        <label for="last-week4">æ˜¨å¹´3é€±å…ˆ è²©å£²æ•°</label>
                        <input type="number" id="last-week4" min="0" placeholder="ä¾‹: 105">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>âš™ï¸ è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="abc-rank">ABCãƒ©ãƒ³ã‚¯</label>
                        <select id="abc-rank">
                            <option value="A">Aãƒ©ãƒ³ã‚¯ (é«˜é‡è¦åº¦ãƒ»æ¬ å“å›é¿)</option>
                            <option value="B">Bãƒ©ãƒ³ã‚¯ (ä¸­é‡è¦åº¦ãƒ»æ¨™æº–ç®¡ç†)</option>
                            <option value="C">Cãƒ©ãƒ³ã‚¯ (ä½é‡è¦åº¦ãƒ»åœ¨åº«å‰Šæ¸›)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lead-time">ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ </label>
                        <input type="number" id="lead-time" value="4" min="1" max="30">
                        <small style="color: #7f8c8d; margin-top: 5px;">æ—¥æ•°</small>
                    </div>
                    <div class="form-group">
                        <label for="order-cycle">ç™ºæ³¨ã‚µã‚¤ã‚¯ãƒ«</label>
                        <input type="number" id="order-cycle" value="7" min="1" max="90">
                        <small style="color: #7f8c8d; margin-top: 5px;">æ—¥æ•°</small>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateInventory()">ğŸ“ˆ é©æ­£åœ¨åº«ã‚’è¨ˆç®—</button>

            <div class="results" id="results">
                <div class="calculation-mode" id="calculation-mode-display"></div>
                
                <h3>è¨ˆç®—çµæœ</h3>
                <div class="result-grid">
                    <div class="result-item">
                        <h4>ç™ºæ³¨ç‚¹</h4>
                        <div class="result-value" id="reorder-point">--</div>
                        <div class="result-unit">å€‹</div>
                    </div>
                    <div class="result-item">
                        <h4>é©æ­£åœ¨åº«ï¼ˆæœ€å¤§åœ¨åº«ï¼‰</h4>
                        <div class="result-value" id="max-inventory">--</div>
                        <div class="result-unit">å€‹</div>
                    </div>
                    <div class="result-item">
                        <h4>å¹³å‡æ—¥æ¬¡éœ€è¦</h4>
                        <div class="result-value" id="daily-demand">--</div>
                        <div class="result-unit">å€‹/æ—¥</div>
                    </div>
                    <div class="result-item">
                        <h4>å®‰å…¨åœ¨åº«</h4>
                        <div class="result-value" id="safety-stock">--</div>
                        <div class="result-unit">å€‹</div>
                    </div>
                </div>

                <div class="calculation-details">
                    <h4>è¨ˆç®—è©³ç´°</h4>
                    <div id="calculation-steps"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDataMode = 'current';

        // ABCåˆ†æã«ã‚ˆã‚‹å®‰å…¨åœ¨åº«ä¿‚æ•°è¨­å®š
        const ABC_SAFETY_COEFFICIENTS = {
            A: 1.65,  // 95%ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ« - æ¬ å“å›é¿æœ€å„ªå…ˆ
            B: 1.28,  // 90%ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ« - æ¨™æº–ç®¡ç†
            C: 0.84   // 80%ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ« - åœ¨åº«å‰Šæ¸›é‡è¦–
        };

        function toggleDataMode(mode) {
            currentDataMode = mode;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
            const lastYearSection = document.getElementById('last-year-section');
            if (mode === 'comparison') {
                lastYearSection.style.display = 'block';
            } else {
                lastYearSection.style.display = 'none';
                // æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                ['last-week1', 'last-week2', 'last-week3', 'last-week4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
            }
        }

        function calculateInventory() {
            // å…¥åŠ›å€¤å–å¾—
            const week1 = parseFloat(document.getElementById('week1').value) || 0;
            const week2 = parseFloat(document.getElementById('week2').value) || 0;
            const week3 = parseFloat(document.getElementById('week3').value) || 0;
            const week4 = parseFloat(document.getElementById('week4').value) || 0;
            const abcRank = document.getElementById('abc-rank').value;
            const leadTime = parseFloat(document.getElementById('lead-time').value) || 4;
            const orderCycle = parseFloat(document.getElementById('order-cycle').value) || 7;

            // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (week1 + week2 + week3 + week4 === 0) {
                alert('è²©å£²å®Ÿç¸¾ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            let modeInfo = {};

            if (currentDataMode === 'current') {
                // ä»Šå¹´ãƒ‡ãƒ¼ã‚¿ã®ã¿ãƒ¢ãƒ¼ãƒ‰
                const result = calculateCurrentOnly(week1, week2, week3, week4, abcRank, leadTime, orderCycle);
                displayResults(result.values, result.steps);
                modeInfo = {
                    title: 'ä»Šå¹´ãƒ‡ãƒ¼ã‚¿ã®ã¿ãƒ¢ãƒ¼ãƒ‰',
                    description: 'éå»4é€±é–“ã®è²©å£²å®Ÿç¸¾ã®ã¿ã‚’ä½¿ç”¨ã—ãŸè¨ˆç®—ã§ã™ã€‚'
                };
            } else {
                // æ˜¨å¹´æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
                const lastWeek1 = parseFloat(document.getElementById('last-week1').value) || 0;
                const lastWeek2 = parseFloat(document.getElementById('last-week2').value) || 0;
                const lastWeek3 = parseFloat(document.getElementById('last-week3').value) || 0;
                const lastWeek4 = parseFloat(document.getElementById('last-week4').value) || 0;

                if (lastWeek1 + lastWeek2 + lastWeek3 + lastWeek4 === 0) {
                    alert('æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ã€Œä»Šå¹´ãƒ‡ãƒ¼ã‚¿ã®ã¿ã€ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const result = calculateWithComparison(
                    week1, week2, week3, week4,
                    lastWeek1, lastWeek2, lastWeek3, lastWeek4,
                    abcRank, leadTime, orderCycle
                );
                displayResults(result.values, result.steps);
                modeInfo = {
                    title: 'æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰',
                    description: 'æ˜¨å¹´åŒæœŸãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒã—ã€å­£ç¯€æ€§ã¨ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è€ƒæ…®ã—ãŸé«˜ç²¾åº¦è¨ˆç®—ã§ã™ã€‚'
                };
            }

            // è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
            document.getElementById('calculation-mode-display').innerHTML = `
                <h5>${modeInfo.title}</h5>
                <p>${modeInfo.description}</p>
            `;
        }

        function calculateCurrentOnly(week1, week2, week3, week4, abcRank, leadTime, orderCycle) {
            const totalSales = week1 + week2 + week3 + week4;
            const averageDailyDemand = totalSales / 28;
            
            // é€±å¹³å‡ã¨æ¨™æº–åå·®
            const weeklyAverage = totalSales / 4;
            const weeklyVariance = ((week1 - weeklyAverage) ** 2 + 
                                  (week2 - weeklyAverage) ** 2 + 
                                  (week3 - weeklyAverage) ** 2 + 
                                  (week4 - weeklyAverage) ** 2) / 4;
            const weeklyStdDev = Math.sqrt(weeklyVariance);
            const dailyStdDev = weeklyStdDev / Math.sqrt(7);

            // ABCå®‰å…¨åœ¨åº«ä¿‚æ•°å–å¾—
            const safetyCoeff = ABC_SAFETY_COEFFICIENTS[abcRank];

            // å®‰å…¨åœ¨åº«è¨ˆç®—
            const safetyStock = safetyCoeff * Math.sqrt(leadTime) * dailyStdDev;

            // ç™ºæ³¨ç‚¹è¨ˆç®—
            const reorderPoint = (averageDailyDemand * leadTime) + safetyStock;

            // ç™ºæ³¨é‡è¨ˆç®—ï¼ˆABCãƒ©ãƒ³ã‚¯ã«é–¢ä¿‚ãªãä¸€å¾‹ï¼‰
            const orderQuantity = averageDailyDemand * orderCycle;

            // é©æ­£åœ¨åº«è¨ˆç®—
            const maxInventory = reorderPoint + orderQuantity;

            const steps = [
                `ã€åŸºæœ¬è¨ˆç®—ã€‘`,
                `åˆè¨ˆè²©å£²æ•°: ${totalSales}å€‹`,
                `å¹³å‡æ—¥æ¬¡éœ€è¦: ${totalSales} Ã· 28 = ${averageDailyDemand.toFixed(2)}å€‹/æ—¥`,
                `é€±è²©å£²æ¨™æº–åå·®: ${weeklyStdDev.toFixed(2)}å€‹`,
                `æ—¥æ¬¡éœ€è¦æ¨™æº–åå·®: ${dailyStdDev.toFixed(2)}å€‹/æ—¥`,
                `ã€åœ¨åº«è¨ˆç®—ã€‘`,
                `å®‰å…¨åœ¨åº«ä¿‚æ•°(${abcRank}ãƒ©ãƒ³ã‚¯): ${safetyCoeff}`,
                `å®‰å…¨åœ¨åº«: ${safetyCoeff} Ã— âˆš${leadTime} Ã— ${dailyStdDev.toFixed(2)} = ${safetyStock.toFixed(1)}å€‹`,
                `ç™ºæ³¨ç‚¹: (${averageDailyDemand.toFixed(2)} Ã— ${leadTime}) + ${safetyStock.toFixed(1)} = ${reorderPoint.toFixed(1)}å€‹`,
                `ç™ºæ³¨é‡: ${averageDailyDemand.toFixed(2)} Ã— ${orderCycle} = ${orderQuantity.toFixed(1)}å€‹`,
                `é©æ­£åœ¨åº«: ${reorderPoint.toFixed(1)} + ${orderQuantity.toFixed(1)} = ${maxInventory.toFixed(1)}å€‹`
            ];

            return {
                values: {
                    dailyDemand: averageDailyDemand,
                    safetyStock: safetyStock,
                    reorderPoint: reorderPoint,
                    maxInventory: maxInventory
                },
                steps: steps
            };
        }

        function calculateWithComparison(week1, week2, week3, week4, lastWeek1, lastWeek2, lastWeek3, lastWeek4, abcRank, leadTime, orderCycle) {
            const currentTotal = week1 + week2 + week3 + week4;
            const lastYearTotal = lastWeek1 + lastWeek2 + lastWeek3 + lastWeek4;
            
            // å­£ç¯€èª¿æ•´ä¿‚æ•°
            const seasonalFactor = currentTotal / lastYearTotal;
            
            // åŸºæœ¬æ—¥æ¬¡éœ€è¦
            const baseDailyDemand = currentTotal / 28;
            
            // äºˆæ¸¬æ—¥æ¬¡éœ€è¦ï¼ˆå­£ç¯€èª¿æ•´é©ç”¨ï¼‰
            const adjustedDailyDemand = baseDailyDemand * Math.min(seasonalFactor, 2.0); // ä¸Šé™2å€ã§å®‰å…¨æ€§ç¢ºä¿
            
            // ä»Šå¹´ã®é€±å¤‰å‹•
            const currentWeeklyAvg = currentTotal / 4;
            const currentWeeklyVar = ((week1 - currentWeeklyAvg) ** 2 + 
                                   (week2 - currentWeeklyAvg) ** 2 + 
                                   (week3 - currentWeeklyAvg) ** 2 + 
                                   (week4 - currentWeeklyAvg) ** 2) / 4;
            
            // æ˜¨å¹´ã®é€±å¤‰å‹•
            const lastYearWeeklyAvg = lastYearTotal / 4;
            const lastYearWeeklyVar = ((lastWeek1 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek2 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek3 - lastYearWeeklyAvg) ** 2 + 
                                     (lastWeek4 - lastYearWeeklyAvg) ** 2) / 4;
            
            // å¹´é–“å¤‰å‹•ã‚’è€ƒæ…®ã—ãŸæ¨™æº–åå·®
            const combinedWeeklyVar = (currentWeeklyVar + lastYearWeeklyVar) / 2;
            const weeklyStdDev = Math.sqrt(combinedWeeklyVar);
            const dailyStdDev = weeklyStdDev / Math.sqrt(7);

            // ABCå®‰å…¨åœ¨åº«ä¿‚æ•°å–å¾—
            const safetyCoeff = ABC_SAFETY_COEFFICIENTS[abcRank];

            // å®‰å…¨åœ¨åº«è¨ˆç®—ï¼ˆèª¿æ•´ã•ã‚ŒãŸéœ€è¦ã¨ã‚ˆã‚Šç²¾å¯†ãªæ¨™æº–åå·®ã‚’ä½¿ç”¨ï¼‰
            const safetyStock = safetyCoeff * Math.sqrt(leadTime) * dailyStdDev;

            // ç™ºæ³¨ç‚¹è¨ˆç®—
            const reorderPoint = (adjustedDailyDemand * leadTime) + safetyStock;

            // ç™ºæ³¨é‡è¨ˆç®—ï¼ˆABCãƒ©ãƒ³ã‚¯ã«é–¢ä¿‚ãªãä¸€å¾‹ï¼‰
            const orderQuantity = adjustedDailyDemand * orderCycle;

            // é©æ­£åœ¨åº«è¨ˆç®—
            const maxInventory = reorderPoint + orderQuantity;

            const steps = [
                `ã€å­£ç¯€æ€§åˆ†æã€‘`,
                `ä»Šå¹´4é€±åˆè¨ˆ: ${currentTotal}å€‹`,
                `æ˜¨å¹´åŒæœŸ4é€±åˆè¨ˆ: ${lastYearTotal}å€‹`,
                `å­£ç¯€èª¿æ•´ä¿‚æ•°: ${currentTotal} Ã· ${lastYearTotal} = ${seasonalFactor.toFixed(3)}`,
                `ã€éœ€è¦äºˆæ¸¬ã€‘`,
                `åŸºæœ¬æ—¥æ¬¡éœ€è¦: ${currentTotal} Ã· 28 = ${baseDailyDemand.toFixed(2)}å€‹/æ—¥`,
                `èª¿æ•´å¾Œæ—¥æ¬¡éœ€è¦: ${baseDailyDemand.toFixed(2)} Ã— ${Math.min(seasonalFactor, 2.0).toFixed(3)} = ${adjustedDailyDemand.toFixed(2)}å€‹/æ—¥`,
                `ã€å¤‰å‹•åˆ†æã€‘`,
                `ä»Šå¹´é€±æ¨™æº–åå·®: ${Math.sqrt(currentWeeklyVar).toFixed(2)}å€‹`,
                `æ˜¨å¹´é€±æ¨™æº–åå·®: ${Math.sqrt(lastYearWeeklyVar).toFixed(2)}å€‹`,
                `çµ±åˆæ—¥æ¬¡æ¨™æº–åå·®: ${dailyStdDev.toFixed(2)}å€‹/æ—¥`,
                `ã€åœ¨åº«è¨ˆç®—ã€‘`,
                `å®‰å…¨åœ¨åº«ä¿‚æ•°(${abcRank}ãƒ©ãƒ³ã‚¯): ${safetyCoeff}`,
                `å®‰å…¨åœ¨åº«: ${safetyCoeff} Ã— âˆš${leadTime} Ã— ${dailyStdDev.toFixed(2)} = ${safetyStock.toFixed(1)}å€‹`,
                `ç™ºæ³¨ç‚¹: (${adjustedDailyDemand.toFixed(2)} Ã— ${leadTime}) + ${safetyStock.toFixed(1)} = ${reorderPoint.toFixed(1)}å€‹`,
                `ç™ºæ³¨é‡: ${adjustedDailyDemand.toFixed(2)} Ã— ${orderCycle} = ${orderQuantity.toFixed(1)}å€‹`,
                `é©æ­£åœ¨åº«: ${reorderPoint.toFixed(1)} + ${orderQuantity.toFixed(1)} = ${maxInventory.toFixed(1)}å€‹`
            ];

            return {
                values: {
                    dailyDemand: adjustedDailyDemand,
                    safetyStock: safetyStock,
                    reorderPoint: reorderPoint,
                    maxInventory: maxInventory
                },
                steps: steps
            };
        }

        function displayResults(values, steps) {
            document.getElementById('daily-demand').textContent = values.dailyDemand.toFixed(1);
            document.getElementById('safety-stock').textContent = Math.ceil(values.safetyStock);
            document.getElementById('reorder-point').textContent = Math.ceil(values.reorderPoint);
            document.getElementById('max-inventory').textContent = Math.ceil(values.maxInventory);

            document.getElementById('calculation-steps').innerHTML = 
                steps.map(step => `<div class="calculation-step">${step}</div>`).join('');

            // çµæœã‚¨ãƒªã‚¢è¡¨ç¤º
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Enterã‚­ãƒ¼ã§è¨ˆç®—å®Ÿè¡Œ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateInventory();
            }
        });
    </script>
</body>
</html>